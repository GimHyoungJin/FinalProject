<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.movio.theater.TheaterDAO">

    <!-- 모든 극장 정보를 가져오는 쿼리 -->
    <select id="getAllTheaters" resultType="kr.co.movio.theater.TheaterDTO">
        SELECT * FROM theater
    </select>

    <!-- 특정 극장 정보를 가져오는 쿼리 -->
    <select id="getTheaterById" parameterType="String" resultType="kr.co.movio.theater.TheaterDTO">
        SELECT * FROM theater WHERE theater_id = #{theater_id}
    </select>

    <!-- 특정 극장의 상세 정보를 가져오는 쿼리 -->
    <select id="getTheaterInfoByTheaterId" parameterType="String" resultType="kr.co.movio.theater.TheaterInfoDTO">
        SELECT theater_id AS theaterId, info_type AS infoType, info_content AS infoContent 
        FROM theater_info 
        WHERE theater_id = #{theater_id}
    </select>
    
    
    <!-- 각 지역별로 몇개의 지점을 가지고 있는지 카운트하는 쿼리 -->
	 <select id="RegionsTheaterCounts" resultType="java.util.Map">
        SELECT region_id, COUNT(theater_id) AS theater_count
        FROM theater
        GROUP BY region_id
    </select>
    
     <!-- 지역 데이터를 가져오는 쿼리 -->
    <select id="getAllRegions"  resultType="java.util.Map">
    	select region_id, region_name
    	from region
    </select>

    
   	<!-- 지역 id와 맞는 극장 지점 데이터를 가져오는 쿼리 -->
	<select id="getTheaters" resultType="java.util.Map" parameterType="Map">
	    SELECT DISTINCT t.theater_name, t.theater_id
	    FROM theater t
	    JOIN screen s ON t.theater_id = s.theater_id
	    JOIN screenmovie sm ON s.screen_id = sm.screen_id
	    WHERE t.region_id = #{region_id}
	      AND sm.movie_id = #{movie_id}  <!-- 영화 ID 조건 추가 -->
	</select>
    
    
    <!-- 특정 극장의 상영 날짜 조회 -->
    <select id="getDistinctDatesByTheater" parameterType="String" resultType="java.util.Map">
	    SELECT DISTINCT scmovie_play AS play_date
	    FROM screenmovie
	    WHERE screen_id IN (SELECT screen_id FROM screen WHERE theater_id = #{theater_id})
	      AND movie_id = #{movie_id}  <!-- 영화 ID 조건 추가 -->
	    ORDER BY scmovie_play
    </select>
	
    <!-- 특정 날짜의 상영 영화 조회 -->
    <select id="getMoviesByTheaterAndDate" parameterType="MAP" resultType="java.util.Map">
		SELECT 
		    sm.scmovie_start AS start_time, 
		    sm.scmovie_end AS end_time, 
		    m.movie_title, 
		    m.poster_url,
		    st.type_name, 
		    s.screen_num
		FROM screenmovie sm
		JOIN movie m ON sm.movie_id = m.movie_id
		JOIN screen s ON sm.screen_id = s.screen_id
		JOIN screen_type st ON s.type_id = st.type_id
		WHERE s.theater_id = #{theater_id} 
		  AND sm.scmovie_play = #{date}
		  AND m.movie_id = #{movie_id} 
		ORDER BY sm.scmovie_start;
    </select>
    
     <!-- 지역 id와 맞는 극장 지점 데이터를 가져오는 쿼리 
    <select id="getTheaters" resultType="java.util.Map" parameterType="String">
    	select theater_name, theater_id
    	from theater 
    	where region_id = #{region_id}
    </select>
    -->
    
</mapper>

