<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="customer">
    <!-- 문의 저장 -->
    <insert id="save" parameterType="kr.co.movio.customer.inquiry.CustomerInquiryDTO">
        INSERT INTO inquiry (inq_num, mem_id, theater_id, inq_type, inq_title, inq_content, inq_date, password)
        VALUES (#{inq_num}, #{mem_id}, #{theater_id}, #{inq_type}, #{inq_title}, #{inq_content}, #{inq_date}, #{password})
    </insert>

    <!-- 문의 번호로 문의 찾기 -->
    <select id="findById" parameterType="String" resultType="kr.co.movio.customer.inquiry.CustomerInquiryDTO">
        SELECT inq_num, mem_id, theater_id, inq_type, inq_title, inq_content, inq_date, password
        FROM inquiry
        WHERE inq_num = #{inq_num}
    </select>

    <!-- 회원 ID로 문의 수 찾기 -->
    <select id="countByMemberId" parameterType="String" resultType="int">
        SELECT COUNT(*)
        FROM inquiry
        WHERE mem_id = #{mem_id}
    </select>

    <!-- 극장 ID로 문의 수 찾기 -->
    <select id="countByTheaterId" parameterType="String" resultType="int">
        SELECT COUNT(*)
        FROM inquiry
        WHERE theater_id = #{theater_id}
    </select>

    <!-- 전체 문의 목록 조회 -->
    <select id="findAllInquiries" resultType="kr.co.movio.customer.inquiry.CustomerInquiryDTO">
        SELECT inq_num, mem_id, theater_id, inq_type, inq_title, inq_content, inq_date, password
        FROM inquiry
        LIMIT #{offset}, #{limit}
    </select>

    <!-- 키워드로 문의 검색 -->
    <select id="searchInquiries" parameterType="Map" resultType="kr.co.movio.customer.inquiry.CustomerInquiryDTO">
        SELECT inq_num, mem_id, theater_id, inq_type, inq_title, inq_content, inq_date, password
        FROM inquiry
        WHERE inq_title LIKE CONCAT('%', #{keyword}, '%') OR mem_id LIKE CONCAT('%', #{keyword}, '%')
        LIMIT #{offset}, #{limit}
    </select>

    <!-- 전체 문의 수 조회 -->
    <select id="getTotalInquiries" resultType="int">
        SELECT COUNT(*)
        FROM inquiry
    </select>

    <!-- 키워드로 검색된 전체 문의 수 조회 -->
    <select id="getTotalInquiriesByKeyword" parameterType="String" resultType="int">
        SELECT COUNT(*)
        FROM inquiry
        WHERE inq_title LIKE CONCAT('%', #{keyword}, '%') OR mem_id LIKE CONCAT('%', #{keyword}, '%')
    </select>

    <!-- 문의 수정 -->
    <update id="update" parameterType="kr.co.movio.customer.inquiry.CustomerInquiryDTO">
        UPDATE inquiry
        SET mem_id=#{mem_id}, theater_id=#{theater_id}, inq_type=#{inq_type}, inq_title=#{inq_title}, 
            inq_content=#{inq_content}, inq_date=#{inq_date}, password=#{password}
        WHERE inq_num=#{inq_num}
    </update>

    <!-- 문의 삭제 -->
    <delete id="delete" parameterType="String">
        DELETE FROM inquiry
        WHERE inq_num = #{inq_num}
    </delete>

    <!-- 문의 답변 저장 -->
    <insert id="saveInquiryDetail" parameterType="kr.co.movio.customer.inquiry.InquiryDetailDTO">
        INSERT INTO inquirydetail (inqde_num, inq_num, inqde_content, inqde_date)
        VALUES (#{inqde_num}, #{inq_num}, #{inqde_content}, #{inqde_date})
    </insert>

    <!-- 문의 번호로 문의 답변 찾기 -->
    <select id="findInquiryDetailsByInquiryId" parameterType="String" resultType="kr.co.movio.customer.inquiry.InquiryDetailDTO">
        SELECT inqde_num, inq_num, inqde_content, inqde_date
        FROM inquirydetail
        WHERE inq_num = #{inq_num}
    </select>
</mapper>
