<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="reservation">

    <!-- 누적 관객 수 조회 -->
    <select id="getTotalAudience" parameterType="string" resultType="int">
        SELECT SUM(r.tot_people)
        FROM reservation r
        JOIN screenmovie sm ON r.screen_movie_id = sm.screen_movie_id
        JOIN movie m ON sm.movie_id = m.movie_id
        WHERE m.movie_id = #{movieId}
    </select>

    <!-- 예매율 조회 -->
    <select id="getMovieGrade" parameterType="string" resultType="double">
        SELECT (SUM(r.tot_people) / (SELECT SUM(tot_people) FROM reservation)) * 100
        FROM reservation r
        JOIN screenmovie sm ON r.screen_movie_id = sm.screen_movie_id
        JOIN movie m ON sm.movie_id = m.movie_id
        WHERE m.movie_id = #{movieId}
    </select>

    <!-- 실관람 평점 조회 -->
    <select id="getRating" parameterType="string" resultType="double">
        SELECT AVG(r.rating)
        FROM review r
        JOIN movie m ON r.movie_id = m.movie_id
        WHERE m.movie_id = #{movieId}
    </select>

</mapper>
