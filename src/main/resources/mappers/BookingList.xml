<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="bookingList">

    <!-- 예약 목록 조회 -->
    <select id="getBookingList" resultType="kr.co.movio.mypage.bookinglist.BookingListDTO">
        SELECT 
            res.res_id AS resId,
            res.mem_id AS memId,
            res.screen_movie_id AS screenMovieId,
            res.res_seat_info AS resSeatInfo,
            res.adult,
            res.teenager,
            res.child,
            res.tot_people AS totPeople,
            res.res_date AS resDate,
            mem.username,
            mem.email,
            scr.movie_id AS movieId,
            mv.movie_title AS movieTitle,
            th.theater_name AS theaterName,
            th.address
        FROM 
            reservation res
        INNER JOIN 
            member mem ON res.mem_id = mem.mem_id
        INNER JOIN 
            screenmovie scr ON res.screen_movie_id = scr.screen_movie_id
        INNER JOIN 
            movie mv ON scr.movie_id = mv.movie_id
        INNER JOIN 
            screen sc ON scr.screen_id = sc.screen_id
        INNER JOIN 
            theater th ON sc.theater_id = th.theater_id
        WHERE 
            res.mem_id = #{memId}
        ORDER BY 
            res.res_date DESC
    </select>

    <!-- 예약 목록 조회 (페이징) -->
    <select id="getBookingListWithPagination" resultType="kr.co.movio.mypage.bookinglist.BookingListDTO">
        SELECT 
            res.res_id AS resId,
            res.mem_id AS memId,
            res.screen_movie_id AS screenMovieId,
            res.res_seat_info AS resSeatInfo,
            res.adult,
            res.teenager,
            res.child,
            res.tot_people AS totPeople,
            res.res_date AS resDate,
            mem.username,
            mem.email,
            scr.movie_id AS movieId,
            mv.movie_title AS movieTitle,
            th.theater_name AS theaterName,
            th.address
        FROM 
            reservation res
        INNER JOIN 
            member mem ON res.mem_id = mem.mem_id
        INNER JOIN 
            screenmovie scr ON res.screen_movie_id = scr.screen_movie_id
        INNER JOIN 
            movie mv ON scr.movie_id = mv.movie_id
        INNER JOIN 
            screen sc ON scr.screen_id = sc.screen_id
        INNER JOIN 
            theater th ON sc.theater_id = th.theater_id
        WHERE 
            res.mem_id = #{memId}
        ORDER BY 
            res.res_date DESC
        LIMIT #{offset}, #{limit}
    </select>

     <!-- 구매 내역 조회 -->
    <select id="getOrderList" resultType="kr.co.movio.mypage.bookinglist.OrderDetailDTO">
        SELECT 
            od.order_detail_no AS orderDetailNo,
            o.order_no AS orderNo,
            o.order_date AS orderDate,
            od.pro_detail_code AS proDetailCode,
            p.pro_name AS productName,
            od.order_detail_price AS orderDetailPrice,
            od.order_detail_amount AS orderDetailAmount,
            o.order_state AS orderState,
            '구매' AS orderType
        FROM 
            orderdetail od
        INNER JOIN 
            orders o ON od.order_no = o.order_no
        INNER JOIN 
            product p ON od.pro_detail_code = p.pro_detail_code
        WHERE 
            o.mem_id = #{memId}
        ORDER BY 
            o.order_date DESC
    </select>

</mapper>
